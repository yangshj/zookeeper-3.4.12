# 数据分类
### 整体分为 3 类：
- 内存数据
- 磁盘数据
    - 快照
    - 事务日志
    
    
### 1.内存数据


- ZK 的数据模型：树
- 树中单个节点包含的内容：
    - 节点数据
    - 节点 ACL 信息
    - 节点的路径
- 具体实现：DataTree 和 DataNode

####  关键点:
1. DataTree内存数据库的核心，代表完整的数据
2. 不包含：任何与网络、客户端连接、请求处理的业务逻辑
3. 单独保存一份临时节点，方便实时访问和清理


### 2.快照数据

快照数据生成的基本过程：


- 异步：异步线程生成快照文件
- Fuzzy 快照：
    - 快照文件生成过程中，仍然有新的事务提交，
    - 因此，快照文件不是精确到某一时刻的快照文件，而是模糊的，
    - 这就要求事务操作是幂等的，否则产生不一致。



### 事务日志
关键点：
- 事务日志频繁 flush 到磁盘，消耗大量磁盘 IO
- 磁盘空间预分配：事务日志剩余空间 < 4KB 时，将文件大小增加 64 MB
- 磁盘预分配的目标：减少磁盘 seek 次数
- 建议：事务日志，采用独立磁盘单独存放

























### 参考文档：
1. ZooKeeper 技术内幕：数据的存储(持久化机制) https://blog.csdn.net/varyall/article/details/79564418  
2. ZooKeeper:15---内部原理（本次存储：日志和磁盘的使用、快照）
https://blog.csdn.net/qq_41453285/article/details/107253015